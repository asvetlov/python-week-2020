<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Делаем консольную программу удобной (Python Week 2020)</title>

    <link rel="stylesheet" href="dist/reset.css">
    <link rel="stylesheet" href="dist/reveal.css">
    <link rel="stylesheet" href="dist/theme/python-week.css" id="theme">

    <!-- Theme used for syntax highlighted code -->
    <link rel="stylesheet" href="plugin/highlight/monokai.css" id="highlight-theme">
    <style type="text/css">
     #footer-right {
       position: absolute;
       bottom: 0%;
       right: 0%;
     }

     #self-link {
       position: absolute;
       bottom: 0%;
       left: 0%;
     }
    </style>
  </head>
  <body>
    <div class="reveal">
      <div class="slides">
	<section data-background-image="title.png">
	  <div class="title-cap">
	    Делаем консольную программу удобной
	  </div>
	  <div class="title-author">
	    Андрей Светлов
	  </div>
	  <small><a href="https://asvetlov.github.io/python-week-2020/">https://asvetlov.github.io/python-week-2020/</a></small>
	</section>
	<section>
	  <h2>Био</h2>
	  <ul>
	    <li>20+ лет с Python</li>
	    <li>CPython Core developer</li>
	    <li>asyncio</li>
	    <li>со-автор aiohttp, yarl, multidict и т.д</li>
	  </ul>
	</section>
	<section>
	  <section>
	    <h1>Проблемы</h1>
	    <h6>или</h6>
	    <h3>Что может пойти не так?</h3>
	    <img class="r-stretch" src="problem1.jpeg"/>
	    <aside class="notes">
	      Я еще в школе научился пользоваться print()!!!
	    </aside>
	  </section>
	  <section>
	    <h2>Информативность</h2>
	    <div class="r-stack">
	      <img src="docker-system-info.png"/>
	      <img class="fragment" src="gh-pr-status.png"/>
	    </div>
	  </section>
	  <section>
	    <h2>Размер шрифта и экрана</h2>
	    <img src="docker-ps.png"/>
	  </section>
	  <section>
	    <h2>Scrolling & Pager</h2>
	    <img src="man-git.png"/>
	    <aside class="notes">
	      Годно для списков файлов, пользователей, объектов и т.д.
	    </aside>
	  </section>
	  <section>
	    <h2>Светлый/тёмный цвет фона</h2>
	    <div class="r-stack">
	      <img src="black-ford-t.jpg"/>
	      <img class="fragment" src="eggs.png"/>
	      <img class="fragment" src="gh-pr-status.png"/>
	      <img class="fragment" src="gh-pr-status-white.png"/>
	      <aside class="notes">
		Автомобиль может быть любого цвета, если этот цвет чОрный
	      </aside>
	    </div>
	  </section>
	  <section>
	    <h2>Цвета и стили</h2>
	    <ul>
	      <li> normal </li>
	      <li style="color:darkgreen;">green</li>
	      <li style="color:red;">red</li>
	      <li style="color:gold;">yellow</li>
	      <li style="color:darkblue">blue</li>
	    </ul>
	    <ul>
	      <li style="color:darkcyan;">cyan</li>
	      <li style="color:darkmagenta;">magenta</li>
	      <li><b>bold</b></li>
	      <li style="color:gray;">dim (gray)</li>
	      <li><u>underline</u></li>
	    </ul>
	    <small>
	      <s><code>TERM=xterm-256color</code></s>
	      <s><code>COLORTERM=truecolor</code></s>
	    </small>
	  </section>
	  <section>
	    <h2>ENV VARS</h2>
	    <h4>как у <s>взрослых</s> ls</h4>
	    <ul>
	      <li><code>LSCOLORS=<font color="darkblue">e</font>x<font color="darkmagenta">f</font>x<font color="darkgreen">c</font>x<font color="gold">d</font>x<font color="red">b</font>x<font color="darkblue">e</font><font color="darkcyan">g</font><font color="darkblue">e</font><font color="gold">d</font>a<font color="red">b</font>a<font color="darkcyan">g</font>a<font color="darkgreen">c</font>a<font color="gold">d</font></code></li>
	      <li><code>LS_COLORS=no=00:<font color="darkblue"><b>di=01;34</b></font>:<font color="darkcyan">ln=00;36</font>:</code><br/>
                <code><font color="darkmagenta"><b>*.jpg=01;35</b></font>:<font color="darkgreen">*.mp3=00;32</font>:<font color="red">*.tgz=00;31</font>:</code>
	      </li>
	    </ul>
	  </section>
	  <section>
	    <h2>Смайлики</h2>
	    <ul>
	      <li><code style="color:darkgreen;"><b>√</b></code></li>
	      <li><code style="color:red;"><b>×</b></code></li>
	      <li><code><s>&#x1f917;</s> → □</code></li>	      
	    </ul>
	    <aside class="notes">
	      Математика -- хорошо!
	      Всегда проверяем доступность в шрифтах, в том числе на Винде
	    </aside>
	  </section>
	  <section>
	    <h2>Shell</h2>
	    <ul>
	      <li>sh</li>
	      <li>bash</li>
	      <li>zsh</li>
	      <li>fish</li>
	      <li>cmd.exe</li>
	      <li>powershell</li>
	    </ul>
	  </section>
	  <section>
	    <h2>TTY навсегда?</h2>
	    <ul>
	      <li><code>not sys.stdout.isatty()</code></li>
	      <li><code>script.py | grep abc</code></li>
	      <li><code>script.py > out.txt</code></li>
	      <li>cron, HTTP сервер и т.д.</li>
	      <li><s>цвета, стили, размер экрана</s></li>
	    </ul>
	  </section>
	  <section>
	    <h2>Windows, любовь моя</h2>
	    <ul>
	      <li><s>less</s> → more</li>
	      <li><s>\n</s> → \r\n</li>
	      <li><s style="color:gray;"> dim / gray </s></li>
	      <li><s>ANSI</s> (по умолчанию)</li>
	      <li><code><s>◢◣◤◥</s> → -\|/</code></li>
	    </ul>
	  </section>
	</section>
	<section>
	  <section>
	    <h1>Инструменты</h1>
	    <img src="multitool.jpg" width="70%" height="70%"/>
	    <aside class="notes">
	      Молоток и напильник у этого Франкенштейна нарисованы не зря!
	    </aside>
	  </section>
	  <section>
	    <h2>click</h2>
	    <a href="https://click.palletsprojects.com/">https://click.palletsprojects.com/</a>
	    <pre><code data-trim data-noescape class="python">
	       import click

	       click.secho(text, bold=True, fg="green")
	       styled_text = click.style(text, dim=True, fg="blue")
	       click.echo(styled_text)
	       click.unstyle(styled_text)
	       click.echo_via_pager(long_styled_text)
	    </code></pre>
	    <small>Автоматически убирает стили для не-терминала (non-TTY)</small>
	  </section>
	  <section>
	    <h2>Python Prompt Toolkit</h2>
	    <a href="https://python-prompt-toolkit.readthedocs.io/">https://python-prompt-toolkit.readthedocs.io/</a>
	    <pre><code data-trim data-noescape class="python">
	       from prompt_toolkit.shortcuts import ProgressBar
	       from prompt_toolkit.formatted_text import HTML
	       import time

	       title = HTML('''Downloading &lt;style bg="yellow" fg="black"&gt;
                        4 files...&lt;/style&gt;''')
	       label = HTML('&lt;ansired&gt;some file&lt;/ansired&gt;: ')

	       with ProgressBar(title=title) as pb:
	           for i in pb(range(800), label=label):
	               time.sleep(.01)
	    </code></pre>
	    <img src="progress.png"/>
	    <small><s>click.progressbar()</s> <s>tqdm</s></small>
	    <aside class="notes">
	      prompt_toolkit -- это не только про fullscreen apps (Tetris & Python REPL)
	    </aside>
	  </section>
	  <section>
	    <h4><s>Big Russian Hammer</s></h2>
	      <h2>Widgets & Layouts</h2>
	      <img src="docker-pull.png"/>
	      <aside class="notes">
		попробуй сгороди такое на tqdm!
	      </aside>
	  </section>
	  <section>
	    <h2>Всё пропало, шеф!</h2>
	    <h4>или "Где мой курсор?"</h4>
	    <pre><code data-trim data-noescape class="python">
              def main():
                  try:
                      ...
                  finally:
                      # Soft Reset WITHOUT Clear Screen
                      sys.stdout.write("\x1b[!p")
                      sys.stdout.flush()
	    </code></pre>
	  </section>
	  <section>
	    <h2>asyncio + click</h2>
	    <pre><code data-trim data-noescape class="python">
              @click.command()
              def main():
                  with AsyncioRunner() as runner:
                      runner.run(async_func())
	    </code></pre>
	    <pre class="fragment"><code data-trim data-noescape class="python">
              @async_command()
              async def main():
                  await async_func()
	    </code></pre>
	  </section>
	  <section>
	    <h2>asyncio + prompt_toolkit</h2>
	    <pre><code data-trim data-noescape class="python">
              from prompt_toolkit import PromptSession
              from prompt_toolkit.patch_stdout import patch_stdout

              async def async_func():
                  session = PromptSession()
                  while True:
                      with patch_stdout():
                          result = await session.prompt_async(
                              'Say something: '
                          )
                      print(f'You said: {result}')
	    </code></pre>
	  </section>
	  <section>
	    <h2>Windows не отпускает</h2>
	    <pre><code data-trim data-noescape class="cpp">
              #include &lt;windows.h&gt;

              HANDLE hConsole = GetStdHandle(STD_OUTPUT_HANDLE);
              /* Enable ANSI mode */
              if (!SetConsoleMode(
                     hConsole,
                     ENABLE_PROCESSED_INPUT |
                     ENABLE_VIRTUAL_TERMINAL_PROCESSING)) {
                printf("Windows 10 is required\n");
              }
	    </code></pre>
	    <small><s>colorama</s></small>
	  </section>
	</section>
	<section>
	  <section>
	    <h1>Полировка</h1>
	    <img src="polishing.jpg" width="70%" height="70%" />
	  </section>
	  <section>
	    validation (convert())
	    autocompletion
	  </section>
	</section>
	<section>
	  <h1>Вопросы?</h1>
	  <h4>Делаем консольную программу удобной</h4>
	  <h4>Андрей Светлов</h4>
	  <small><a href="https://asvetlov.github.io/python-week-2020/">https://asvetlov.github.io/python-week-2020/</a></small>
	</section>
      </div>
    </div>

    <div id="hidden" style="display:none;">
      <div id="header">
        <div id="footer-right">
	  <img src="logo.svg" width="30%" height="30%">
	</div>
      </div>
    </div>

    <script src="dist/reveal.js"></script>
    <script src="plugin/notes/notes.js"></script>
    <script src="plugin/markdown/markdown.js"></script>
    <script src="plugin/highlight/highlight.js"></script>
    <script>
     // More info about initialization & config:
     // - https://revealjs.com/initialization/
     // - https://revealjs.com/config/
     Reveal.initialize({
       hash: true,
       slideNumber: "c/t",
       totalTime: 30 * 60,
       controlsTutorial: false,
       // Learn about plugins: https://revealjs.com/plugins/
       plugins: [ RevealMarkdown, RevealHighlight, RevealNotes ]
     });
    </script>

    <script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
    <script type="text/javascript">
     // 3. On Reveal.js ready event, copy header/footer <div> into each `.slide-background` <div>
     var header = $('#header').html();
     if ( window.location.search.match( /print-pdf/gi ) ) {
       Reveal.addEventListener( 'ready', function( event ) {
         $('.slide-background').append(header);
       });
     }
     else {
       $('div.reveal').append(header);
     }
    </script>
  </body>
</html>
